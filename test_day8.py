import day8
import pytest

test_input = """
............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............
""".strip()


def test_parse_input():
    city = day8.City.from_input(test_input)
    assert city.freqs == {
        "0": {
            (8, 1),
            (5, 2),
            (7, 3),
            (4, 4),
        },
        "A": {
            (6, 5),
            (8, 8),
            (9, 9),
        },
    }
    assert city.bounds == (11, 11)


def test_antinodes():
    city = day8.City.from_input(test_input)

    assert city.antinodes((8, 1), (5, 2)) == {(11, 0), (2, 3)}
    assert city.antinodes((5, 2), (8, 1)) == {(11, 0), (2, 3)}

    assert city.antinodes((5, 2), (7, 3)) == {(3, 1), (9, 4)}
    assert city.antinodes((7, 3), (5, 2)) == {(3, 1), (9, 4)}


def test_repeating_antinodes():
    city = day8.City.from_input(test_input, repeating_antinodes=True)
    assert city.antinodes((5, 2), (7, 3)) == {
        (1, 0),
        (3, 1),
        (5, 2),
        (7, 3),
        (9, 4),
        (11, 5),
    }


def test_antinodes_off_map():
    city = day8.City.from_input(test_input)
    assert city.antinodes((6, 5), (9, 9)) == {(3, 1)}


@pytest.mark.skip(reason="test is sensitive to unimportant ordering")
def test_pairs():
    city = day8.City.from_input(test_input)
    assert set(city.pairs({(6, 5), (8, 8), (9, 9)})) == {
        ((8, 8), (6, 5)),
        ((8, 8), (9, 9)),
        ((6, 5), (9, 9)),
    }


def test_antinodes_for_freq():
    city = day8.City.from_input(test_input)
    assert city.antinodes_for_freq("A") == {
        (7, 7),
        (10, 10),
        (10, 11),
        (3, 1),
        (4, 2),
    }


def test_count_antinodes():
    city = day8.City.from_input(test_input)
    assert len(city.all_antinodes()) == 14


def test_count_repeating_antinodes():
    city = day8.City.from_input(test_input, repeating_antinodes=True)
    assert len(city.all_antinodes()) == 34


def test_real_count_antinodes():
    city = day8.City.from_input(real_input)
    assert len(city.all_antinodes()) == 295


def test_real_count_repeating_antinodes():
    city = day8.City.from_input(real_input, repeating_antinodes=True)
    assert len(city.all_antinodes()) == 1034


real_input = """
..f........................8......................
G............8..u.................................
........G...p.....................................
......d.....................n.....................
..................................................
.....................................K............
..................F...8.n...B.K...................
....b.........8..u................................
...............F.p.......B.............4.....5....
....f..d..U.........................c.............
...........U.....d.n.u.0................5.........
...Y.......f..........................5...........
..........................u.....d.....e.........4.
..F...p.............v........n....................
....s.............0...............................
...US.s....g.....D..........................4.....
......wG...............S..........................
.............................B.....e..............
.........w.........................A..............
.............9w.g..........................4......
U....9..g.....v.....P....D.....f.K................
.s.............0..9........pP..........5..........
..9s...................P..........................
.............b..................0.....A..2....e...
....................b.....V..v....................
.......7........B......................A..........
..................D6...V....q.....................
...v............D....PV...........................
.........Y...........g.......................e..y.
.......SW......V..7....................c..........
.......bY7.....................N........A.........
.....................q.N..........y...............
........................N.........c...............
..................................................
.........C..7..................q........2.........
............................N...q.................
...W......C3...Q................a1.........y......
.......W.......................3......2...........
........3...........6.............1...............
....3............C.1....................k.........
E..................................a.....c........
.............................................w....
..S.......................Q..........2......k.....
......................C....6.......Q......ak......
..................................................
.................E.............a1............y....
W..........E......................................
......E...........6...........Q...................
...........................k......................
..................................................
""".strip()
